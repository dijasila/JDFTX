<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>JDFTx: ASE Interface</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="jdftx-55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">JDFTx
   &#160;<span id="projectnumber">1.7.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('ASE.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ASE Interface </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>JDFTx contains a python interface class to the <a href="https://wiki.fysik.dtu.dk/ase/">Atomic Simulation Environment</a>. This provides a quick but powerful interface to many features, including <a href="https://wiki.fysik.dtu.dk/ase/ase/phonons.html">phonons</a> and <a href="https://wiki.fysik.dtu.dk/ase/ase/md.html">ab-initio molecular dynamics</a> alternative to the now built-in versions, or to barrier calculations using the <a href="https://wiki.fysik.dtu.dk/ase/ase/neb.html">nudged-elastic band</a> method.</p>
<p>The current implementation of the interface is as a force calculator, which only exchanges forces and potential energies with ASE.</p>
<h2><a class="anchor" id="autotoc_md21"></a>
Installation</h2>
<p>The interface is available with the JDFTx source code, under the scripts directory (/jdftx/scripts/ase). After installing JDFTx and ASE (follow instructions for each), set the python path to access the interface file. For example, in unix-based systems, add </p><pre class="fragment">   export PYTHONPATH=/path-to-jdftx/scripts/ase:$PYTHONPATH
</pre><p> to ~/.bashrc or ~/.profile files. Once this is done, you can import the JDFTx calculator in python using: </p><pre class="fragment">   from JDFTx import JDFTx
</pre> <h2><a class="anchor" id="autotoc_md22"></a>
Use</h2>
<p>The JDFTx interface needs to know the path to the executable and to pseudopotentials (if not using a built-in pseudopotential set). This can be done using arguments executable and pseudoDir in the constructor, or by setting environment variables JDFTx and JDFTx_pseudo respectively.</p>
<p>The easiest way to use the interface is to set the environment variables </p><pre class="fragment">export JDFTx=/path/to/jdftx
export JDFTx_pseudo=/path/to/pseudopotential/directory
</pre><p> in the current shell, or in the ~/.bashrc or ~/.profile files. Using the constructor, these would be instead: </p><pre class="fragment">calculator = JDFTx(
    executable='/path/to/jdftx',
    pseudoDir='/path/to/pseudopotential/directory'
)
</pre><p> The latter variable / argument is only needed if not using a built-in set like GBRV or SG15. If using one of these pseudopotential sets, it is sufficient to only specify the executable and name the set eg. using </p><pre class="fragment">calculator = JDFTx(
    executable='/path/to/jdftx',
    pseudoSet='GBRV-pbe'
)
</pre><p> where the supported sets are GBRV (shorthand for GBRV-pbe), GBRV-lda, GBRV-pbesol and SG15.</p>
<p>Finally, to use MPI or a job management system like SLURM, use: </p><pre class="fragment">calculator = JDFTx(executable='mpirun -n Nprocs /path/to/jdftx')
</pre><p> or </p><pre class="fragment">calculator = JDFTx(executable='srun -n Nprocs /path/to/jdftx')
</pre><p> Note that the command that submits the job eg. srun should not release the shell until the job is completed. Therefore, in slurm, srun would work, but not sbatch.</p>
<h2><a class="anchor" id="autotoc_md23"></a>
Example</h2>
<p>Below is a sample python script that uses jdftx through the ASE interface to calculate the bond length of CO molecule using the BFGS minimization algorithm. Note that you must edit the executable path in the code below (or remove that argument and set the environment variable JDFTx). </p><pre class="fragment">from ase import Atoms
from JDFTx import JDFTx

d = 1.1 #Initial bond length guess
CO = Atoms('CO', 
    positions=[(0, 0, 0), (0, 0, d)],
    cell=[(6,0,0),(0,6,0),(0,0,7)],
    pbc = [False, False, False])

#Set up JDFTx calculator
calculator = JDFTx(
    pseudoSet='GBRV',
    commands={'elec-cutoff' : '20 100'}
)
CO.set_calculator(calculator)

#Structure optimization
from ase.optimize import BFGS
dyn = BFGS(CO)
dyn.run(fmax=0.05)

calculator.clean()  #Clean up run files from /tmp
</pre><p> Output from this script will look something like: </p><pre class="fragment">Set up JDFTx calculator with run files in '/tmp/tmpXXXXXXXX'
  Step     Time          Energy         fmax
BFGS:    0 16:54:05     -591.653710        5.8379
BFGS:    1 16:54:13     -591.689501        3.9552
BFGS:    2 16:54:20     -591.766731        0.7019
BFGS:    3 16:54:26     -591.768793        0.1145
BFGS:    4 16:54:30     -591.768846        0.0040
</pre><p> See the <a href="https://wiki.fysik.dtu.dk/ase/tutorials/tutorials.html">ASE tutorials</a> for many examples illustrating ASE's features; it is then straightforward to instead use the JDFTx calculator in any of those examples.</p>
<h2><a class="anchor" id="autotoc_md24"></a>
Extracting outputs</h2>
<div class="image">
<img src="CO.png" alt=""/>
</div>
<p>Any feature of JDFTx, such as solvation, can be used simply by passing an appropriate dict of JDFTx input file commands, as shown in the example for elec-cutoff. However, dump-name and initial-state will be overridden to work in a temporary path.</p>
<p>If you need to access the dumped files - you can add dumped variables using the dump command as usual, then copy them out from calculator.runDir before calling calculator.clean(). For example, this modified version of the above script outputs the electron density and visualizes it using the <a href="createXSF.html">createXSF script</a> and VESTA (add them to path or set absolute paths). It also uses the SG15 pseudopotentials set instead of GBRV for illustration: </p><pre class="fragment">from ase import Atoms
from JDFTx import JDFTx, shell

d = 1.1 #Initial bond length guess
CO = Atoms('CO', 
    positions=[(0, 0, 0), (0, 0, d)],
    cell=[(6,0,0),(0,6,0),(0,0,7)],
    pbc = [False, False, False])

#Set up JDFTx calculator
calculator = JDFTx(
    pseudoSet='SG15',
    commands={
        'elec-cutoff' : '30',
        'dump' : 'End ElecDensity'
    }
)
CO.set_calculator(calculator)

#Structure optimization
from ase.optimize import BFGS
dyn = BFGS(CO)
dyn.run(fmax=0.05)

#Create XSF and visualize:
shell('createXSF %s/out CO.xsf %s/n' % ((calculator.runDir,)*2))
shell('VESTA CO.xsf &amp;')
calculator.clean()         #Clean up run files from /tmp
</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
</div>
</body>
</html>
